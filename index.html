<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yazboz Master Pro+ Kilitli</title>
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: #0f172a; color: white; font-family: -apple-system, sans-serif; margin: 0; padding: 0; }
        .header { padding: 12px; background: #1e293b; text-align: center; border-bottom: 2px solid #334155; }
        .main-container { padding: 5px; }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; background: #1e293b; border-radius: 8px; overflow: hidden; }
        th { background: #0f172a; padding: 10px 0; color: #93c5fd; font-size: 13px; border: 1px solid #334155; }
        td { padding: 4px 1px; border: 1px solid #334155; text-align: center; vertical-align: middle; }
        .row-info { display: flex; flex-direction: column; align-items: center; gap: 2px; }
        .edit-btn { background: #475569; border: none; color: white; padding: 4px; width: 32px; border-radius: 4px; font-size: 12px; cursor: pointer; }
        .score-input { width: 94%; padding: 10px 0; border-radius: 6px; border: 2px solid transparent; background: #334155; color: white; text-align: center; font-weight: bold; font-size: 18px; outline: none; }
        .score-input:focus { border-color: #60a5fa; background: #0f172a; }
        .score-input.negative { background: #059669 !important; border-color: #059669; }
        .active-row { background: rgba(59, 130, 246, 0.15); }
        .locked-row { background: rgba(0, 0, 0, 0.5) !important; opacity: 0.6; pointer-events: none; }
        /* Kilitli satırdaki butonun tıklanabilir kalması için */
        .locked-row .edit-btn { pointer-events: auto; }
        .total-row { background: #0f172a; color: #fbbf24; font-weight: bold; font-size: 18px; }
        
        .controls-wrapper { margin-top: 10px; background: #1e293b; padding: 10px; border-radius: 12px; border: 1px solid #334155; }
        .penalty-label { font-size: 12px; color: #94a3b8; margin-bottom: 8px; text-align: center; font-weight: bold; text-transform: uppercase; }
        .multi-btns { display: flex; gap: 4px; margin-bottom: 12px; }
        .btn { flex: 1; padding: 15px 2px; border: none; border-radius: 8px; font-weight: bold; color: white; font-size: 14px; }
        
        .btn-red { background: #dc2626; } 
        .btn-black { background: #334155; color: #f8fafc; border: 1px solid #475569; } 
        .btn-yellow { background: #ca8a04; } 
        .btn-blue { background: #2563eb; }
        .btn-reset { background: #7f1d1d; flex: 0.5; }

        .penalty-grid { display: flex; gap: 6px; }
        .p-btn { flex: 1; padding: 15px 0; border-radius: 10px; border: none; color: white; font-weight: bold; font-size: 14px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.3); }
        .p-btn span { display: block; font-size: 10px; opacity: 0.8; }
    </style>
</head>
<body>
    <div class="header"><h3 style="margin:0; font-style:italic; color:#60a5fa;">PRO YAZBOZ MASTER+</h3></div>
    <div class="main-container">
        <table>
            <thead>
                <tr>
                    <th style="width: 18%;">No</th>
                    <th style="width: 20.5%;">P1</th>
                    <th style="width: 20.5%;">P2</th>
                    <th style="width: 20.5%;">P3</th>
                    <th style="width: 20.5%;">P4</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <script>
                    for(let i=0; i<11; i++) {
                        document.write(`<tr id="row-${i}">
                            <td><div class="row-info"><strong>${i+1}</strong><button class="edit-btn" onclick="setEditRow(${i})">✍️</button></div></td>
                            <td><input type="number" inputmode="numeric" class="score-input" id="r${i}p0" onfocus="setActive(0,${i})" oninput="calculateTotals()"></td>
                            <td><input type="number" inputmode="numeric" class="score-input" id="r${i}p1" onfocus="setActive(1,${i})" oninput="calculateTotals()"></td>
                            <td><input type="number" inputmode="numeric" class="score-input" id="r${i}p2" onfocus="setActive(2,${i})" oninput="calculateTotals()"></td>
                            <td><input type="number" inputmode="numeric" class="score-input" id="r${i}p3" onfocus="setActive(3,${i})" oninput="calculateTotals()"></td>
                        </tr>`);
                    }
                </script>
            </tbody>
            <tfoot>
                <tr class="total-row">
                    <td>TOP</td>
                    <td id="tot0">0</td><td id="tot1">0</td><td id="tot2">0</td><td id="tot3">0</td>
                </tr>
            </tfoot>
        </table>

        <div class="controls-wrapper">
            <div class="penalty-label">Çarpanlar</div>
            <div class="multi-btns">
                <button class="btn btn-red" onclick="applyMulti(4)">4x</button>
                <button class="btn btn-black" onclick="applyMulti(5)">5x</button>
                <button class="btn btn-yellow" onclick="applyMulti(6)">6x</button>
                <button class="btn btn-blue" onclick="applyMulti(7)">7x</button>
                <button class="btn btn-reset" onclick="resetGame()">SİL</button>
            </div>

            <div class="penalty-label">Hızlı Ödül Puanları</div>
            <div class="penalty-grid">
                <button class="p-btn btn-red" onclick="applyPenalty(40)">-40<span>KIRMIZI</span></button>
                <button class="p-btn btn-black" onclick="applyPenalty(50)">-50<span>SİYAH</span></button>
                <button class="p-btn btn-yellow" onclick="applyPenalty(60)">-60<span>SARI</span></button>
                <button class="p-btn btn-blue" onclick="applyPenalty(70)">-70<span>MAVİ</span></button>
            </div>
        </div>
    </div>

    <script>
        let activeRow = 0;
        let activePlayer = 0;
        let locks = Array(11).fill(false);

        function setActive(p, r) {
            if(locks[r]) return; // Kilitli satıra odaklanma
            activePlayer = p;
            activeRow = r;
            document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active-row'));
            document.getElementById('row-' + r).classList.add('active-row');
        }

        function setEditRow(idx) {
            locks[idx] = false;
            const row = document.getElementById('row-' + idx);
            row.classList.remove('locked-row');
            // Girdileri tekrar aç
            for(let p=0; p<4; p++){
                document.getElementById(`r${idx}p${p}`).readOnly = false;
            }
            setActive(0, idx);
            document.getElementById(`r${idx}p0`).focus();
            calculateTotals();
        }

        function calculateTotals() {
            for (let p = 0; p < 4; p++) {
                let sum = 0;
                for (let r = 0; r < 11; r++) {
                    let inp = document.getElementById(`r${r}p${p}`);
                    let v = parseInt(inp.value) || 0;
                    sum += v;
                    inp.classList.toggle('negative', v < 0);
                }
                document.getElementById('tot' + p).innerText = sum;
            }
        }

        function lockRow(idx) {
            locks[idx] = true;
            const row = document.getElementById('row-' + idx);
            row.classList.add('locked-row');
            for(let p=0; p<4; p++){
                document.getElementById(`r${idx}p${p}`).readOnly = true;
            }
        }

        function applyMulti(m) {
            if (locks[activeRow]) return alert("Bu satır kilitli!");
            let hasValue = false;
            for (let p = 0; p < 4; p++) {
                let inp = document.getElementById(`r${activeRow}p${p}`);
                let v = parseInt(inp.value) || 0;
                if (v > 0) {
                    inp.value = v * m;
                    hasValue = true;
                }
            }
            if (hasValue) {
                lockRow(activeRow);
                calculateTotals();
                if (activeRow < 10) setEditRow(activeRow + 1);
            }
        }

        function applyPenalty(points) {
            if (locks[activeRow]) return alert("Bu satır kilitli! Önce düzenle butonuna basın.");
            let targetInp = document.getElementById(`r${activeRow}p${activePlayer}`);
            
            if (targetInp.value !== "" && targetInp.value !== "0") {
                alert("Hatalı Giriş! Bu hücre dolu. Lütfen önce silin veya düzenle butonuyla kilidi açın.");
                return;
            }

            targetInp.value = -Math.abs(points);
            calculateTotals();
        }

        function resetGame() {
            if (confirm("Tüm oyun sıfırlansın mı?")) {
                location.reload();
            }
        }
    </script>
</body>
</html>
